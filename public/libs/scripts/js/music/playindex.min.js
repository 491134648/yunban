function $(t){return document.querySelectorAll(t)}function random(t,e){return Math.round(Math.random()*(e-t)+t)}function getDots(){Dots=[];for(var t=0;size>t;t++){var e=random(0,width),i=random(0,height),a="rgba("+random(0,255)+","+random(0,255)+","+random(0,255)+",0)";Dots.push({x:e,y:i,dx:random(1,4),color:a,cap:0})}}function resize(){height=box.clientHeight,width=box.clientWidth,canvas.height=height,canvas.width=width,ctx.globalCompositeOperation="lighter",ctx.lineWidth=(height>width?width:height)/30,line=ctx.createLinearGradient(0,0,0,height),line.addColorStop(0,"red"),line.addColorStop(.5,"yellow"),line.addColorStop(1,"green"),getDots()}function draw(){return function(t,e){ctx.clearRect(0,0,width,height);var i=width/size,a=.6*i,o=a>10?10:a;if(ctx.fillStyle=line,"dot"==draw.type&&(t>3&&e>30||e>50&&t>0))for(var r=Math.round(t*(e-20)*.01)+4,h=0;r>h;h++){var n=random(2*-height,3*height);ctx.beginPath(),ctx.moveTo(0,n),ctx.lineTo(width,height-n),ctx.strokeStyle="rgb("+random(100,250)+","+random(50,250)+","+random(50,100)+")",ctx.stroke()}for(var h=0;size>h;h++){var l=Dots[h];if("column"===draw.type){var c=this[h]/256*height;ctx.fillRect(i*h,height-c,a,c),ctx.fillRect(i*h,height-(l.cap+o),a,o),l.cap--,l.cap<0&&(l.cap=0),c>0&&l.cap<c+40&&(l.cap=c+40>height-o?height-o:c+40)}else if("dot"===draw.type){ctx.beginPath();var d=10+this[h]/256*(height>width?width:height)/10;ctx.arc(l.x,l.y,d,0,2*Math.PI,!0);var s=ctx.createRadialGradient(l.x,l.y,0,l.x,l.y,d);s.addColorStop(0,"#fff"),s.addColorStop(1,l.color),ctx.fillStyle=s,ctx.fill(),l.x+=l.dx,l.x=l.x>width?0:l.x}}}}var lis=$("#list li"),size=32,box=$("#box")[0],height,width,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");box.appendChild(canvas);for(var Dots=[],line,mv=new MusicVisualizer({size:size,visualizer:draw()}),i=0;i<lis.length;i++)lis[i].onclick=function(){for(var t=0;t<lis.length;t++)lis[t].className="";this.className="selected",mv.play("/media/music/"+this.title)};resize(),window.onresize=resize,draw.type="dot";for(var types=$("#type li"),i=0;i<types.length;i++)types[i].onclick=function(){for(var t=0;t<types.length;t++)types[t].className="";this.className="selected",draw.type=this.getAttribute("data-type")};$("#volume")[0].onmousemove=function(){mv.changeVolume(this.value/this.max)},$("#volume")[0].onmousemove();