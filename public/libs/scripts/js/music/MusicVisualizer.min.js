function MusicVisualizer(i){this.source=null,this.count=0,this.analyser=MusicVisualizer.ac.createAnalyser(),this.size=i.size,this.analyser.fftSize=2*this.size,this.gainNode=MusicVisualizer.ac[MusicVisualizer.ac.createGain?"createGain":"createGainNode"](),this.gainNode.connect(MusicVisualizer.ac.destination),this.analyser.connect(this.gainNode),this.xhr=new XMLHttpRequest,this.visualizer=i.visualizer,this.visualize()}MusicVisualizer.ac=new(window.AudioContext||window.webkitAudioContext),MusicVisualizer.prototype.load=function(i,e){this.xhr.abort(),this.xhr.open("GET",i),this.xhr.responseType="arraybuffer";var t=this;this.xhr.onload=function(){e(t.xhr.response)},this.xhr.send()},MusicVisualizer.prototype.decode=function(i,e){MusicVisualizer.ac.decodeAudioData(i,function(i){e(i)},function(i){console.log(i)})},MusicVisualizer.prototype.play=function(i){var e=++this.count,t=this;this.source&&this.source[this.source.stop?"stop":"noteOff"](),this.load(i,function(i){e==t.count&&t.decode(i,function(i){if(e==t.count){var n=MusicVisualizer.ac.createBufferSource();n.connect(t.analyser),n.buffer=i,n[n.start?"start":"noteOn"](0),t.source=n}})})},MusicVisualizer.prototype.changeVolume=function(i){this.gainNode.gain.value=i*i},MusicVisualizer.prototype.visualize=function(){function i(){t.analyser.getByteFrequencyData(e);var s=Math.round(100*Array.prototype.reduce.call(e,function(i,e){return i+e})/t.size/256),a=s-n;n=s,t.visualizer.call(e,a,s),requestAnimationFrame(i)}var e=new Uint8Array(this.analyser.frequencyBinCount);requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;var t=this,n=0;requestAnimationFrame(i)};