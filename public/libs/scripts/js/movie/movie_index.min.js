"use strict";$.support.cors=!0,$(function(){function e(e,t,i){$.ajax({url:e,cache:!0,type:t,crossDomain:!0}).done(i)}(function(){var t=$(".col-md-6").width();(function(){function i(e){var i=(d-1)*t;$("#screenBody").is(":animated")||("right"===e?s===d?(s=1,$("#scrollMovies .side-index").html(s),$("#screenBody").animate({left:0},500)):(s++,$("#scrollMovies .side-index").html(s),$("#screenBody").animate({left:"-="+t},500)):1===s?(s=d,$("#scrollMovies .side-index").html(s),$("#screenBody").animate({left:"-="+i},500)):(s--,$("#scrollMovies .side-index").html(s),$("#screenBody").animate({left:"+="+t},500)))}var l=($("#scrollMovies .panel"),$("#headerNow span")),s=1,n=$("#scrollMovies .slide-prev"),o=$("#scrollMovies .slide-next"),a=$("#scrollMovies .thumbnail"),r=a.length,c=$(window).width();if(768>c)var d=Math.ceil(r/3),v=a.outerWidth(!0)-a.outerWidth(),h=(t-3*v)/3;else var d=Math.ceil(r/4),v=a.outerWidth(!0)-a.outerWidth(),h=(t-4*v)/4;$("#scrollMovies .side-max").html(d),$("#screenBody").width(t*d),a.width(h),l.on("click",function(){var i=$(this).text(),n="/movieIndex?galleryName="+encodeURIComponent(i);e(n,"GET",function(e){var n=e||[],o=n.movies,m=n.movies.length;if($("#headerNow a").attr("href","/movie/results?q="+n.name+"&p=0").text(n.name),"即将上映"===i?l.text("正在热映"):l.text("即将上映"),m<a.length)$("#scrollMovies .thumbnail:gt("+(m-1)+")").remove();else if(m>a.length){for(var f=a.length;m>f;f++)$("#screenBody").append('<div class="thumbnail scroll-item"><a href=""><img src="" alt=""/></a><div class="caption"><h5></h5><p><a href="" role="button" class="btn btn-primary">观看预告片</a></p></div></div>');$("#screenBody .thumbnail:gt("+(a.length-1)+")").width(h)}a=$("#scrollMovies .thumbnail"),r=a.length,c=$(window).width(),768>c?(d=Math.ceil(r/3),v=a.outerWidth(!0)-a.outerWidth(),h=(t-3*v)/3):(d=Math.ceil(r/4),v=a.outerWidth(!0)-a.outerWidth(),h=(t-4*v)/4),$("#scrollMovies .side-max").html(d),$("#screenBody").width(t*d);for(var u=0;u<a.length;u++)if(o[u]){$(a[u]).find("a").attr("href","/movie/"+o[u]._id),$(a[u]).find("h5").html(o[u].title);var p=$(a[u]).find("img");o[u].poster&&(o[u].poster.indexOf("http")>-1?p.attr("src",o[u].poster).attr("alt",o[u].title):p.attr("src","/upload/movie/"+o[u].poster).attr("alt",o[u].title))}s>d&&(s=d,$("#scrollMovies .side-index").html(s),$("#screenBody").animate({left:-t*(s-1)},0))})}),o.on("click",function(){i("right")}),n.on("click",function(){i("left")});var m=setInterval(function(){i("right")},5e3);$("#scrollMovies").on("mouseover",function(){clearInterval(m)}).on("mouseout",function(){m=setInterval(function(){i("right")},5e3)})})();$("#fliterMovies .class-top").on("click","button",function(){if(!$(this).is(".btn-primary")){$("#fliterMovies input[checked]").removeAttr("checked"),$("#fliterMovies input[value=pv]").attr("checked","checked"),$("#fliterMovies input[value=pv]").prop("checked","checked");var t=$(this).html(),i="/movieIndex?fliterName="+encodeURIComponent(t+"电影");e(i,"GET",function(e){if(null===e.data||0===e.data.movies.length)$("#classBody").html("");else{var t=e.data.movies,i=$("#classBody .thumbnail"),l=t.length-1;if(t.length<i.length)$("#fliterMovies .col-md-3:gt("+l+")").remove();else if(t.length>i.length)for(var s=i.length;s<t.length;s++)$("#classBody").append('<div class="col-md-3 col-sm-3 col-xs-4"><div class="thumbnail"><a href=""><img src="" alt=""/></a><div class="caption"><h5></h5></div></div></div>');i=$("#classBody .thumbnail");for(var n=0;n<i.length;n++)if(t[n]){$(i[n]).find("a").attr("href","/movie/"+t[n]._id),$(i[n]).find("h5").html(t[n].title+'&nbsp;<stong style="color: #e09015;">'+t[n].rating);var o=$(i[n]).find("img");t[n].poster&&(t[n].poster.indexOf("http")>-1?o.attr("src",t[n].poster).attr("alt",t[n].poster):o.attr("src","/upload/movie/"+t[n].poster).attr("alt",t[n].title))}}}),$(this).addClass("btn-primary").removeClass("btn-default").parent().siblings().children().addClass("btn-default").removeClass("btn-primary")}});var i=0;$("#fliterMovies .more").on("click",function(){var t=$("#fliterMovies .btn-primary").html(),l=$("#fliterMovies input[checked]").val();i++;var s="/movieIndex?catName="+encodeURIComponent(t+"电影")+"&p="+i+"&checkedName="+l;e(s,"GET",function(e){var t=e||[];if(t.length&&t.length>0)for(var i=0;i<t.length;i++)t[i].poster.indexOf("http")>-1?$("#classBody").append('<div class="col-md-3 col-sm-3 col-xs-4"><div class="thumbnail"><a href="/movie/'+t[i]._id+'"><img src="'+t[i].poster+'" alt="'+t[i].title+'"/></a><div class="caption"><h5>'+t[i].title+'&nbsp;<stong style="color: #e09015;">'+t[i].rating+"</stong></h5></div></div></div>"):$("#classBody").append('<div class="col-md-3 col-sm-3 col-xs-4"><div class="thumbnail"><a href="/movie/'+t[i]._id+'"><img src="/upload/movie/'+t[i].poster+'" alt="'+t[i].title+'"/></a><div class="caption"><h5>'+t[i].title+'&nbsp;<stong style="color: #e09015;">'+t[i].rating+"</stong></h5></div></div></div>");else $("#fliterMovies .more").html("无更多结果")}),$("#fliterMovies .btn-default").on("click",function(){i=0,$("#fliterMovies .more").html("加载更多")}),$('#fliterMovies input[name="sort"]').on("click",function(){i=0})}),$('#fliterMovies input[name="sort"]').on("click",function(){$("#fliterMovies .more").html("加载更多");var t=$(this).val();$("#fliterMovies input[checked]").removeAttr("checked"),$("#fliterMovies input[value="+t+"]").attr("checked","checked"),$("#fliterMovies input[value="+t+"]").prop("checked","checked");var i=$("#fliterMovies .btn-primary").html(),l="/movieIndex?sortName="+t+"&category="+encodeURIComponent(i+"电影");e(l,"GET",function(e){var t=e||[];if(t.length&&t.length>0){$("#fliterMovies .col-md-3").remove();for(var i=0;i<t.length;i++)t[i].poster.indexOf("http")>-1?$("#classBody").append('<div class="col-md-3 col-sm-3 col-xs-4"><div class="thumbnail"><a href="/movie/'+t[i]._id+'"><img src="'+t[i].poster+'" alt="'+t[i].title+'"/></a><div class="caption"><h5>'+t[i].title+'&nbsp;<stong style="color: #e09015;">'+t[i].rating+"</stong></h5></div></div></div>"):$("#classBody").append('<div class="col-md-3 col-sm-3 col-xs-4"><div class="thumbnail"><a href="/movie/'+t[i]._id+'"><img src="/upload/movie/'+t[i].poster+'" alt="'+t[i].title+'"/></a><div class="caption"><h5>'+t[i].title+'&nbsp;<stong style="color: #e09015;">'+t[i].rating+"</stong></h5></div></div></div>")}})});(function(){function e(e){$("oUl").is(":animated")||("right"===e?i===n?(i=1,$("#galleryFrames .side-index").html(i),o.animate({left:0},500)):(i++,$("#galleryFrames .side-index").html(i),o.animate({left:"-="+t},500)):1===i?(i=n,$("#galleryFrames .side-index").html(i),o.animate({left:"-="+t*(n-1)},500)):(i--,$("#galleryFrames .side-index").html(i),o.animate({left:"+="+t},500)))}var i=1,l=$("#galleryFrames .slide-prev"),s=$("#galleryFrames .slide-next"),n=$("#galleryFrames li").length,o=$("#galleryFrames ul"),a=$("#galleryFrames .slide-item");$("#galleryFrames .side-max").html(n),a.width(t),o.width(t*n),s.on("click",function(){e("right")}),l.on("click",function(){e("left")});var r=setInterval(function(){e("right")},5e3);$("#galleryFrames").on("mouseover",function(){clearInterval(r)}).on("mouseout",function(){r=setInterval(function(){e("right")},5e3)})})(),function(){function t(){var t=i.children("span").text(),l=o.val(),a="/movieIndex?cityName="+encodeURIComponent(t)+"&&search="+encodeURIComponent(l);e(a,"GET",function(e){var t=e||[];n.html("");for(var i=0;i<t.length;i++)n.append('<li><a href="javascript:;">'+t[i]+"</a></li>");s.css("display","block")})}var i=$("#citySearch"),l=$("#citiesList"),s=($("#citySug"),$("#citySug .city-suggestion-list")),n=$("#citySug .auto-tip"),o=$("#citySug input");i.children("span").on("click",function(){"none"===l.css("display")?l.css("display","block"):l.css("display","none")}),$(".cities-list-hd").on("click","li",function(){var e=$(this).attr("index");$(this).addClass("on").siblings().removeClass("on"),l.find(".cities-list-item").eq(e-1).addClass("active").siblings().removeClass("active")}),$("#citiesList .cities-list-item").on("click","a",function(){i.children("span").html($(this).text()),l.css("display","none"),o.val("")}),o.on("focus",function(){t(),l.css("display","none")}),o.keyup(function(e){t()}),s.on("mousedown","a",function(){o.val($(this).text()),s.css("display","none")}),o.on("blur",function(){s.css("display","none")})}()})()});